<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
<title>Single-Sheet Quiz (with Timer & Mobile Verify)</title>

<!-- Optional: MathJax if you use formulas -->
<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$','$$'], ['\\[','\\]']] },
  options: { renderActions: { addMenu: [] } },
  startup: { typeset: false }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>

<style>
  :root{--primary:#1E90FF;--accent:#1b4332;}
  body{font-family:Arial, sans-serif;margin:0;background:#f5f7fa;color:#111}
  .wrap{max-width:920px;margin:18px auto;padding:18px}
  h1{color:var(--primary);text-align:center;margin:6px 0 18px}
  .card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(10,10,10,0.05);margin-bottom:14px}
  input[type="text"],select{width:100%;padding:10px;border-radius:8px;border:1px solid #d0d7de;font-size:15px;box-sizing:border-box}
  button{background:var(--primary);color:#fff;border:none;padding:10px 14px;border-radius:8px;font-size:15px;cursor:pointer}
  .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
  .question-nav{display:flex;gap:6px;overflow:auto;padding:8px 0;color:black}
  .question-nav button{width:36px;height:36px;border-radius:50%;border:1px solid #ddd;background:#fff}
  .question-nav button.answered{background:var(--accent);color:#fff;border-color:var(--accent)}
  .question-nav button.active{border:2px solid #333}
  .options label{display:block;border:1px solid #ddd;border-radius:8px;padding:10px;margin:8px 0;cursor:pointer}
  .options label.correct{background:#e8fce8;border-color:green}
  .options label.wrong{background:#ffe8e8;border-color:red}
  .footer-fixed{position:fixed;left:0;right:0;bottom:8px;display:flex;justify-content:center;gap:8px;padding:0 12px;pointer-events:none}
  .footer-fixed .btn{pointer-events:auto;max-width:920px;width:100%;display:flex;gap:8px}
  .footer-fixed button{flex:1}
  #timer{font-weight:700;color:#c0392b}
  #result-section{display:none;margin-top:10px}
  .hidden{display:none}
  @media (max-width:640px){ .topbar{flex-direction:column;align-items:stretch} }
</style>
</head>
<body>
<div class="wrap">

  <!--<h1>Quiz</h1>-->

  <!-- MOBILE VERIFICATION -->
  <div id="mobile-card" class="card">
    <h3>Enter registered mobile number</h3>
    <input id="mobileInput" type="text" placeholder="Mobile number (e.g. 6301186741)" />
    <div style="margin-top:10px;text-align:center">
      <button onclick="verifyMobile()">Verify & Continue</button>
    </div>
    <p style="color:#666;font-size:13px;margin-top:8px">Note: Edit <code>allowedMobiles</code> in the script to configure which numbers are allowed.</p>
  </div>

  <!-- QUIZ AREA -->
  <div id="quiz-area" class="card hidden">
    <div class="topbar" style="margin-bottom:10px;">
      <div style="display:flex;align-items:center;gap:10px;">
        <div>
          <!--<label><strong></strong></label>
          <div id="quizNameDisplay" style="padding:8px 10px;background:#fafafa;border-radius:8px;border:1px solid #eee"></div>
        </div>-->
      </div>

      <div style="text-align:right;">
        <div id="stats" style="font-size:14px;margin-bottom:6px;">
          <span id="answered">Answered: 0</span> &nbsp;|&nbsp;
          <span id="not-answered">Not answered: 0</span>
        </div>
        <div>Timer: <span id="timer">00:00</span></div>
      </div>
    </div>

    <div id="question-nav" class="question-nav"></div>

    <div id="question-container"></div>

    <div id="result-section" class="card"></div>
  </div>

</div>

<!-- Footer fixed navigation -->
<div class="footer-fixed">
  <div class="btn" style="max-width:920px;margin:0 auto">
    <button onclick="prevQuestion()">Previous</button>
    <button id="submitBtn" onclick="submitQuiz()">Submit</button>
    <button onclick="nextQuestion()">Next</button>
  </div>
</div>
  <script>
/* ================== CONFIG ================== */

/* Your Apps Script URL */
const APP_URL = "https://script.google.com/macros/s/AKfycbwxv4aEXRp-IDYuJj_6FRrJkZX3CDUi1CvdR58_BVEKzBuArz2gNHdXO9wZSnRXtw8hrw/exec";

/* Allowed mobiles */
const allowedMobiles = ["6301186741", "9876543210"];

/* Timer */
const SECONDS_PER_QUESTION = 60;

/* ===================================================== */

let allQuestions = [];
let answers = [];
let current = 0;
let submitted = false;
let userMobile = "";

let timerTotal = 0;
let timerInterval = null;

/* ---------------- MOBILE VERIFICATION ---------------- */
function verifyMobile() {
    const m = document.getElementById("mobileInput").value.trim();

    if (!m) return alert("Enter mobile number");
    if (!allowedMobiles.includes(m)) return alert("Mobile not registered");

    userMobile = m;

    loadQuestionsFromSheet();
}

/* ---------------- LOAD QUESTIONS (APPS SCRIPT) ---------------- */
async function loadQuestionsFromSheet() {
    try {
        const res = await fetch(APP_URL);   // <-- CORRECT URL
        allQuestions = await res.json();    // <-- DIRECT JSON ARRAY

        if (!Array.isArray(allQuestions) || allQuestions.length === 0) {
            alert("No questions found. Check your Sheet4 data.");
            return;
        }

        answers = Array(allQuestions.length).fill(null);
        current = 0;
        submitted = false;

        timerTotal = allQuestions.length * SECONDS_PER_QUESTION;

        document.getElementById("mobile-card").style.display = "none";
        document.getElementById("quiz-area").style.display = "block";

        renderNav();
        renderQuestion();
        startTimer();

    } catch (e) {
        console.error(e);
        alert("Could not load quiz.\nCheck Apps Script URL & permissions.");
    }
}

/* ---------------- RENDER NAV BUTTONS ---------------- */
function renderNav() {
    const nav = document.getElementById("question-nav");
    nav.innerHTML = "";

    allQuestions.forEach((q, i) => {
        const btn = document.createElement("button");
        btn.innerText = i + 1;

        if (i === current) btn.classList.add("active");
        if (answers[i] !== null) btn.classList.add("answered");

        btn.onclick = () => {
            current = i;
            renderQuestion();
        };

        nav.appendChild(btn);
    });

    updateStats();
}

/* ---------------- RENDER QUESTION ---------------- */
function renderQuestion() {
    const q = allQuestions[current];

    let html = `<h3>Q${current + 1}. ${q.q}</h3><div class="options">`;

    q.opts.forEach((opt, i) => {
        let cls = "";
        const checked = answers[current] === i ? "checked" : "";
        const disabled = submitted ? "disabled" : "";

        if (submitted) {
            if (i === q.answerId) cls = "correct";
            else if (answers[current] === i) cls = "wrong";
        }

        html += `
            <label class="${cls}">
                <input type="radio" name="opt" ${checked} ${disabled}
                    onchange="selectOption(${i})">
                ${opt}
            </label>`;
    });

    html += `</div>`;
    document.getElementById("question-container").innerHTML = html;

    renderNav();
}

/* ---------------- SELECT OPTION ---------------- */
function selectOption(i) {
    if (submitted) return;
    answers[current] = i;
    renderNav();
}

/* ---------------- TIMER ---------------- */
function startTimer() {
    timerInterval = setInterval(() => {
        timerTotal--;
        let m = Math.floor(timerTotal / 60);
        let s = ("0" + (timerTotal % 60)).slice(-2);
        document.getElementById("timer").innerText = `${m}:${s}`;

        if (timerTotal <= 0) submitQuiz();

    }, 1000);
}

/* ---------------- SUBMIT QUIZ ---------------- */
function submitQuiz() {
    if (submitted) return;

    submitted = true;
    clearInterval(timerInterval);

    let correct = 0;
    let wrong = 0;

    allQuestions.forEach((q, i) => {
        if (answers[i] === q.answerId) correct++;
        else if (answers[i] != null) wrong++;
    });

    const skipped = allQuestions.length - (correct + wrong);
    const score = Math.round(correct / allQuestions.length * 100);

    document.getElementById("result-section").innerHTML = `
        <h3>Quiz Completed</h3>
        <p><b>Mobile:</b> ${userMobile}</p>
        <p><b>Total Questions:</b> ${allQuestions.length}</p>
        <p><b>Correct:</b> ${correct}</p>
        <p><b>Wrong:</b> ${wrong}</p>
        <p><b>Skipped:</b> ${skipped}</p>
        <p><b>Score:</b> ${score}%</p>
    `;

    document.getElementById("result-section").style.display = "block";

    renderQuestion(); // show highlights
}

/* ---------------- NAVIGATION ---------------- */
function nextQuestion() {
    if (current < allQuestions.length - 1) {
        current++;
        renderQuestion();
    }
}
function prevQuestion() {
    if (current > 0) {
        current--;
        renderQuestion();
    }
}

/* ---------------- STATS ---------------- */
function updateStats() {
    const answered = answers.filter(a => a !== null).length;
    document.getElementById("answered").innerText = "Answered: " + answered;
    document.getElementById("not-answered").innerText =
        "Not answered: " + (allQuestions.length - answered);
}
</script>

</body>
</html>
